name: cron

on:
  schedule:
    - cron: "* * * * *"  # 每 5 分钟运行一次
  workflow_dispatch:  # 手动触发

jobs:
  probe:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: Check URL and trigger workflow if down
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://xui.pusytroller.cf)
          echo "$(date): Status=$STATUS"
          
          if [ "$STATUS" -lt 200 ] || [ "$STATUS" -ge 300 ]; then
            echo "Trigger target workflow..."
            curl -X POST \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer $GITHUB_TOKEN" \
              -H "X-GitHub-Api-Version: 2022-11-28" \
              https://api.github.com/repos/jussysalad/workspace/actions/workflows/pan.yml/dispatches \
              -d '{"ref":"main"}'
          fi
